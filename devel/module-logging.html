<!-- $Id$ -->
<!-- $Source$ -->

<html>
<head>
<title>ProFTPD Developer's Guide: Module Logging</title>
</head>

<body bgcolor=white>

<hr><br>
<center>
<img src="../images/proftpd.png" border=0>
<br><br>
<h3><b>ProFTPD Developer's Guide: Module Logging</b></h3>
<i><b>ProFTPD Version 1.2</b></i><br>
</center>
<hr><br>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<p>
<b>Module Logging</b><br>
Logging is an important part of any module.  It helps the administrator
keep track of what the module is doing, and of any problems that might be
causing trouble.

<p>
The first step is to <code>#define</code> a label for your module:
<pre>
  #define MOD_<i>module-name</i>_VERSION  "mod_<i>name</i>/<i>version</i>"
</pre>
For example, <code>mod_wrap</code> has:
<pre>
  #define MOD_WRAP_VERSION "mod_wrap/1.2.3"
</pre>
This identifying label helps to determine the version of your module, should
someone need to check what version they are using.  It is also an extremely
helpful part of the logging process.

<p>
<b>Logging</b><br>
When developing a module, please make use of
<a href="../api/functions.html#log_pri"><code>log_pri()</code></a> and
<a href="../api/functions.html#log_debug"><code>log_debug()</code></a> where
appropriate.  Not only will this aid you as your module develops, but it
will help users report potential problems once your module is released.
When calling these functions, make use of the <code>#define</code>d module
label:
<pre>
  log_pri(LOG_ERR, MOD_WRAP_VERSION ": error: unable to open '%s': %s", path, strerror(errno));

  log_debug(DEBUG4, MOD_WRAP_VERSION ": checking ACLs for user %s", session.user));
</pre>
With statements like this, the output from your module is much more easily
identified in the server log files.  Not all third-party modules do this,
it is true; it is a good habit to adopt, though.

<p>
For some modules, it makes more sense to have them log to their own separate
log files, rather than adding the module-specific output to the rest of
<code>proftpd</code>'s logging.  Some caveats if using this approach: check
for world-writeable directories (logs should not accessible to the world), be
<b>very</b> cautious of logging as root (what files might you be overwriting,
filesystem/disk space) , <code>stat()</code>ing for symlinks (race conditions),
etc..  These should all be core-provided services, but are not...yet.  For
examples of such logging code, see <code>mod_quotatab</code> or
<code>mod_rename</code>.

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<hr><br>

Author: <i>$Author$</i><br>
Last Updated: <i>$Date$</i><br>

<br><hr>

<font size=2><b><i>
&copy; Copyright 2000-2003 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>

<hr><br>

</body>
</html>
