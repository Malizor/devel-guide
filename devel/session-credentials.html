<!-- $Id$ -->
<!-- $Source$ -->

<html>
<head>
<title>ProFTPD Developer's Guide: Obtaining Session Credentials</title>
</head>

<body bgcolor=white>

<hr><br>
<center>
<img src="../images/proftpd.png" border=0>
<br><br>
<h3><b>ProFTPD Developer's Guide: Obtaining Session Credentials</b></h3>
<i><b>ProFTPD Version 1.2</b></i><br>
</center>
<hr><br>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<p>
<b>Session Credentials</b><br>
The credentials of a session, or its identity, are available via members of
the global <a href="../api/typedefs.html#session_t"><code>session</code></a>
variable.  The credentials include user information, group membership
information, and <code>Class</code> information (if used).

<p>
<b>The <code>session</code> user members</b><br>
These members are all set after the <code>PASS</code> command has been
processed:
<ul>
  <li><code>uid_t session.uid</code>
    <p>
    This is the user's ID as supplied by the authentication layer.
  </li>

  <p>
  <li><code>char *session.user</code>
    <p>
    During authentication, this member is set to the authenticated user's
    user name.  Note that this user name may be different from the
    user name originally sent by the client if <code>UserAlias</code>es
    are being used.  If authentication fails for any reason, this is
    set to <code>NULL</code>.
  </li>

  <p>
  <li><code>char *session.ident_user</code>
    <p>
    This member contains the name of the remote user as established
    using the ident protocol (RFC1413), once connection to the server has
    been made by the client, before any FTP commands are processed.
    If <code>IdentLookups</code> is set to <em>off</em>, this will be
    &quot;UKNOWN&quot;.
  </li>

  <p>
  <li><code>char *session.anon_user</code>
    <p>
    This member only has a value if the login is an anonymous one;
    otherwise, its value will be <code>NULL</code>.  For anonymous
    logins, this member will contain the &quotpassword&quot; (usually an
    email address) sent by the client.  However, if
    <code>AnonRequirePassword</code> is set to <em>on</em>, it will
    contain the original username sent by client.
  </li>
</ul>
In addition to these <code>session</code> members, there is an additional
place in which user identity information (specifically, the user name
originally sent by the client in the <code>USER</code> command) is stored: in
a <code>config_rec</code>, and is retrievable like this:
<pre>
  char *user = (char *) get_param_ptr(main_server->conf, C_USER, FALSE);
</pre>
This <code>config_rec</code> is set in
<a href="../api/functions.html#cmd_pass"><code>cmd_pass()</code></a>, and is
never removed.

<p>
<b>The <code>session</code> group members</b><br>
These members are all set after the <code>PASS</code> command has been
processed:
<ul>
  <li><code>gid_t session.gid</code>
    <p>
    This is the user's primary GID, as supplied by the authentication layer.
  </li>

  <p>
  <li><code>char *session.group</code>
    <p>
    This is the user's primary group name, as supplied by the authentication
    layer.
  </li>

  <p>
  <li><code>array_header *session.gids</code><br>
      <code>array_header *session.groups</code>
    <p>
    <code>session.gids</code> contains <code>gid_t</code>s;
    <code>session.groups</code> contains strings, group names to match the
    IDs in <code>session.gids</code>.  These arrays provide the supplemental
    group membership, and are filled in by the authentication layer.
  </li>
</ul>

<p>
<b>The <code>session</code> <code>Class</code> member</b><br>
<ul>
  <li><code>class_t *session.class</code>
    <p>
    If <code>Classes</code> are being used (<i>i.e.</i> <code>Class</code> is
    set to <em>on</em>), this member will contain a pointer to the
    <code>Class</code> struct for the current session.  It is set
    once the client has connected to the server, before any modules'
    child initialization handlers have been run and before any FTP commands
    are processed.
  </li>
</ul>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<hr><br>

Author: <i>$Author$</i><br>
Last Updated: <i>$Date$</i><br>

<br><hr>

<font size=2><b><i>
&copy; Copyright 2000-2002 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>

<hr><br>

</body>
</html>
