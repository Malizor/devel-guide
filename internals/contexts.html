<!-- $Id$ -->
<!-- $Source$ -->

<html>
<head>
<title>ProFTPD Developer's Guide: Internals - Configuration Contexts</title>
</head>

<body bgcolor=white>

<hr><br>
<center>
<img src="../images/proftpd.png">
<br><br>
<h3><b>ProFTPD Developer's Guide: Internals - Configuration Contexts</b></h3>
<i><b>ProFTPD Version 1.2.0</b></i><br>
</center>
<hr><br>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<p>
<b>Configuration Contexts</b><br>
At present, ProFTPD has seven different configuration <i>contexts</i>:
&quot;main&quot; server, <code>&lt;Anonymous&gt;</code>,
<code>&lt;Directory&gt;</code>, <code>&lt;Global&gt;</code>,
<code>&lt;Limit&gt;</code>, <code>&lt;VirtualHost&gt;</code>, and
<code>.ftpaccess</code> files.

<p>
<b>&quot;Main&quot; server</b><br>
The &quot;main&quot; server context, listed as &quot;server config&quot; on
the configuration directive list, encompasses everything outside of the
other contexts, and signalled by the macro
<a href="../api/macros.html#CONF_ROOT"><code>CONF_ROOT</code></a> in a
configuration directive handler.

<p>
<b><code>&lt;Anonymous&gt;</code></b><br>
<a href="http://www.proftpd.net/docs/configuration.html#Anonymous">
<code>&lt;Anonymous&gt;</code></a><br>
<a href="../api/macros.html#CONF_ANON"><code>CONF_ANON</code></a>

<p>
<b><code>&lt;Directory&gt;</code></b><br>
<a href="http://www.proftpd.net/docs/configuration.html#Directory">
<code>&lt;Directory&gt;</code></a><br>
<a href="../api/macros.html#CONF_DIR"><code>CONF_DIR</code></a>

<p>
<b><code>&lt;Global&gt;</code></b><br>
The description in the documentation for the
<a href="http://www.proftpd.net/docs/configuration.html#Global">
<code>&lt;Global&gt;</code></a> context is good.  Another point to know is
that if a directive is set in this context, and then the same directive is
used in the main or <code>&lt;VirtualHost&gt;</code> contexts with different
parameters, those parameters take precedence over the
<code>&lt;Global&gt;</code> parameters.  This allows you to configure things
for everyone equally, then tweak the specific servers that you wish to
something else.

<p>
In configuration directive handlers and context checks, this context uses the
<a href="../api/macros.html#CONF_GLOBAL"><code>CONF_GLOBAL</code></a> macro.

<p>
<b><code>&lt;Limit&gt;</code></b><br>
<a href="http://www.proftpd.net/docs/configuration.html#Limit">
<code>&lt;Limit&gt;</code></a><br>
<a href="../api/macros.html#CONF_LIMIT"><code>CONF_LIMIT</code></a>

<p>
<b><code>&lt;VirtualHost&gt;</code></b><br>
<a href="http://www.proftpd.net/docs/configuration.html#VirtualHost">
<code>&lt;VirtualHost&gt;</code></a><br>
<a href="../api/macros.html#CONF_VIRTUAL"><code>CONF_VIRTUAL</code></a>

<p>
<b><code>.ftpaccess</code> files</b><br>
These files are akin to Apache's <code>.htaccess</code> files, which
are parsed-on-the-fly configuration files -- with restricted scopes -- that
users can place in their own directories.  Configuration directive handlers
allow for the handled configuration directive to be placed in this context
via use of the
<a href="../api/macros.html#CONF_DYNDIR"><code>CONF_DYNDIR</code></a> macro.

<p>
<b>Creating your own contexts</b><br>

<a href="../api/functions.html#start_sub_config"><code>start_sub_config()</code></a>
<pre>
MODRET add_limit(cmd_rec *cmd)
{
  config_rec *c;
  int cargc;
  char **argv,**cargv;

  if(cmd->argc < 2)
    CONF_ERROR(cmd,"directive requires one or more FTP commands.");
  CHECK_CONF(cmd,CONF_ROOT|CONF_VIRTUAL|CONF_DIR|CONF_ANON|CONF_DYNDIR|CONF_GLOBAL);

  c = start_sub_config("Limit");
  c->config_type = CONF_LIMIT;
  cargc = cmd->argc-1;
  cargv = cmd->argv+1;

  c->argc = cmd->argc-1;
  c->argv = pcalloc(c->pool,cmd->argc*sizeof(void*));
  argv = (char**)c->argv;

  while(cargc--)
    *argv++ = pstrdup(permanent_pool,*cargv++);

  *argv = NULL;

  return HANDLED(cmd);
}
</pre>

<a href="../api/functions.html#end_sub_config"><code>end_sub_config()</code></a>
<pre>
MODRET end_limit(cmd_rec *cmd)
{
  CHECK_ARGS(cmd,0);
  CHECK_CONF(cmd,CONF_LIMIT);

  end_sub_config();
  return HANDLED(cmd);
}
</pre>

<a href="../api/functions.html#get_section_name"><code>get_section_name()</code></a><br>
<code>#define CONF_MYCTX</code><br>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<hr><br>

Author: <i>$Author$</i><br>
Last Updated: <i>$Date$</i><br>

<br><hr>

<font size=2><b><i>
&copy; Copyright 2000 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>

<hr><br>

</body>
</html>
