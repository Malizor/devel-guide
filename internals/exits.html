<!-- $Id$ -->
<!-- $Source$ -->

<html>
<head>
<title>ProFTPD Developer's Guide: Exit Handlers</title>
</head>

<body bgcolor=white>

<hr><br>
<center>
<img src="../images/proftpd.png" border=0>
<br><br>
<h3><b>ProFTPD Developer's Guide: Exit Handlers</b></h3>
<i><b>ProFTPD Version 1.2</b></i><br>
</center>
<hr><br>

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<p>
<b>Exit Handlers</b><br>
Sometimes, a module developer may wish to have a bit of code executed when
an FTP session ends, or when the daemon is being shut down.  ProFTPD's API
allows for this by providing the following callback registration function:
<pre>
  <a href="../src/src/support.c.html#pr_exit_register_handler">pr_exit_register_handler(void (*)(void))</a>
</pre>
All such registered callbacks will be executed, in their order of registration,
as part of the exit process for the session, or for the daemon.  Exit handlers
that are registered during part of a module's session initialization will
be executed when the session ends; exit handlers registered during module
initialization (<i>e.g.</i> when the daemon starts up) will be executed
both during a session exit (the <code>fork()</code>ed child process handling
the FTP session inherits its parent's memory space) and when the daemon shuts
down.  The callbacks executed during daemon shutdown will be run with root
privileges.

<p>
<b><i>Do not</i></b> re-register exit handlers; register them only <i>once</i>,
during module/session initialization.  Mulitple registration will cause the
callback to be executed multiple times, which is probably not what is
intended.  Also, take care when writing exit handlers.  Be sure to check
that pointers are not NULL, that the state is as needed, in order to prevent
segfaulting in the callback.

<p>
<center><a href="../toc.html">Table of Contents</a></center><br>

<hr><br>

Author: <i>$Author$</i><br>
Last Updated: <i>$Date$</i><br>

<br><hr>

<font size=2><b><i>
&copy; Copyright 2000-2003 TJ Saunders<br>
 All Rights Reserved<br>
</i></b></font>

<hr><br>

</body>
</html>
